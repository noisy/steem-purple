ifndef LIBDIR
	LIBDIR=lib
endif

ifndef FULL_LIBDIR
	FULL_LIBDIR=usr/${LIBDIR}
endif

PACKAGE_NAME= @PACKAGE_NAME@
CC= @CC@
CFLAGS= @CFLAGS@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

CFLAGS+=@PURPLE_CFLAGS@ @GTK_CFLAGS@ -fPIC -DPIC -std=c99
#CFLAGS+=-Wall -Wextra -Wconversion -Wsign-conversion -Winit-self -Wunreachable-code --pedantic  -Wstrict-aliasing
#CFLAGS+= -g -ggdb

LDFLAGS+=@PURPLE_LIBS@ @GTK_LIBS@ -shared -ggdb -fPIC -DPIC

all: compile
clean:
	rm -f *.so
	rm -f *.o
	rm -f ${PODIR}*.mo
install:
	${INSTALL_PROGRAM} -Dm0755 lib$(PACKAGE_NAME).so  ${DESTDIR}/${FULL_LIBDIR}/purple-2/$(PACKAGE_NAME).so
uninstall:
	rm -f ${DESTDIR}/${FULL_LIBDIR}/purple-2/libmrim-underbush.so
	rm -f ${DESTDIR}/${FULL_LIBDIR}/purple-2/mrim.so
	rm -f ${DESTDIR}/${FULL_LIBDIR}/purple-2/mrim-underbush.so
	rm -f ${DESTDIR}/${FULL_LIBDIR}/purple-2/libmrim.so
compile: mrim.o package.o statuses.o cl.o message.o mrim-util.o ft.o
	${CC} ${LDFLAGS} -o lib$(PACKAGE_NAME).so mrim.o package.o statuses.o cl.o message.o mrim-util.o ft.o
mrim.o: mrim.c mrim.h statuses.h cl.h message.h package.h config.h ft.h
	${CC} -c ${CFLAGS} -o mrim.o mrim.c
package.o: package.c mrim.h statuses.h cl.h message.h package.h config.h
	${CC} -c ${CFLAGS} -fPIC -DPIC -o package.o package.c
statuses.o: statuses.c mrim.h statuses.h cl.h message.h package.h config.h
	${CC} -c ${CFLAGS} -fPIC -DPIC -o statuses.o statuses.c
cl.o: cl.c mrim.h statuses.h cl.h message.h package.h config.h
	${CC} -c ${CFLAGS} -fPIC -DPIC -o cl.o cl.c
ft.o: ft.c ft.h mrim.h package.h cl.h config.h
	${CC} -c ${CFLAGS} -fPIC -DPIC -o ft.o ft.c
message.o: message.c mrim.h statuses.h cl.h message.h package.h config.h
	${CC} -c ${CFLAGS} -fPIC -DPIC -o message.o message.c
mrim-util.o: mrim-util.c mrim-util.h mrim.h config.h
	${CC} -c ${CFLAGS} -fPIC -DPIC -o mrim-util.o mrim-util.c

